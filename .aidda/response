
File: /home/stevegt/lab/grid-cli/v2/doc/325-mount.md
```
# Handling Trie Transitions with Mount Handlers

## Overview

In PromiseGrid, the concept of a mount handler module is vital for managing transitions between different trie structures, such as moving from a root or parent trie to a mounted child trie. This document explores how these transitions are managed and provides detailed examples of the process.

## Sequence Matching and Handlers

### Sequence Fault and Handler Invocation

When a search within a trie reaches the end of a stored sequence (a sequence fault), it must invoke the most recent handler module in the sequence.

- **Sequence Fault**: Occurs when a search does not find a complete match within the current trie.
- **Handler Invocation**: The last handler in the matching sequence is invoked.

### Example of Sequence Fault Handling

1. **Root Trie Search**:
   - The system searches the root trie for a sequence.

2. **Sequence Fault**:
   - Upon reaching the end of a stored sequence without finding a match, a sequence fault is declared.

3. **Invoke Mount Handler**:
   - The system invokes the most recent handler within the sequence.
   - If this handler is a mount handler, it continues the search within the mounted child trie associated with the handler.

## Mount Handlers and Trie Jumping

### Implementing a Mount Handler

A mount handler is a module that facilitates the transition from one trie to another. It must be designed to recognize sequence faults and handle the continuation of the search in the appropriate child trie.

- **Root Trie**: The parent trie where the search begins.
- **Child Trie**: The trie mounted by the mount handler, which continues the search.

### Example Process

1. **Initialization**:
   - The root trie includes references to mount handlers that can lead to child tries.

2. **Search Invocation**:
   - The search starts in the root trie and follows the sequence.

3. **Sequence Fault**:
   - Upon encountering a sequence fault, the mount handler is invoked.
   - The mount handler recognizes the fault and redirects the search to the appropriate child trie.

4. **Child Trie Search**:
   - The search continues in the child trie, starting from the beginning of the sequence that caused the fault.

5. **Completion**:
   - If a match is found in the child trie, the response is returned to the caller.
   - If another sequence fault occurs, the process repeats, potentially invoking further mount handlers.

### Embedded Mount Handler

In scenarios where the root trie is managed by an embedded handler loaded from the kernel's embedded resources, this handler may be analogous to a boot loader. The embedded trie acts as a miniroot.

- **Kernel Embedded Trie**: Preloaded trie managed by an embedded handler.
- **Boot Loader Analogy**: The embedded handler initializes the trie structure, ensuring that further mount handlers can link to additional trie resources.

## Practical Example

Imagine a scenario where Node A requests a service from Node B, and the service search transitions from the root trie to a child trie managed by a mount handler.

1. **Node B's Root Trie**:
   - Root trie contains initial sequences and references to mount handlers.

2. **Request from Node A**:
   - Node A sends a request that starts a search in Node B's root trie.

3. **Sequence Fault in Root Trie**:
   - Search in the root trie encounters a sequence fault.
   - The referenced mount handler is invoked.

4. **Mount Handler Redirection**:
   - The mount handler identifies the child trie and redirects the search to continue there.

5. **Search in Child Trie**:
   - The search resumes in the child trie, looking for a match.

6. **Service Fulfillment**:
   - If a match is found, the service request is fulfilled.
   - The response is sent back to Node A.

In this process, the mount handler ensures seamless transitions between trie structures, enabling distributed and decentralized search capabilities across multiple trie resources.

### Analyzing UNIX/Linux Kernel Handling of Mount Points

UNIX and Linux kernels handle transitions between different mounted filesystems at mount points with similar trie-based transitions. When traversing the filesystem tree and encountering a mount point, the kernel transitions from the current filesystem tree to the root of the mounted filesystem tree and continues path resolution within the new filesystem. Below are the key aspects of how these kernels manage such transitions:

1. **Mount Table**:
   - A global mount table maps mount points to the mounted filesystems.
   - Each entry specifies the directory that acts as the mount point and the root of the mounted filesystem.

2. **Pathname Resolution**:
   - While resolving a pathname during a syscall (e.g., `open`, `stat`), the kernel traverses the VFS (Virtual File System) tree.
   - If a directory's inode indicates it is a mount point, the traverse switches to the root of the mounted filesystem.
   - This traversal continues recursively if additional mount points are encountered.

3. **VFS Layer**:
   - The VFS abstracts the specifics of different filesystems, allowing uniform treatment.
   - It manages the transitions between filesystems by handling mount points internally.

4. **Mount Point Handling**:
   - Pathname traversal checks each directory's inode.
   - Upon reaching a mount point, the VFS redirects the traversal to the appropriate filesystem.
   - The pathname resolution then continues within the new filesystem tree.

## Conclusion

Mount handlers play a critical role in managing transitions between trie structures within the PromiseGrid system. By handling sequence faults and directing searches to appropriate child tries, they ensure efficient and flexible search operations in a decentralized environment. The embedded mount handlers serve as initializers, analogous to boot loaders, setting up the foundational trie structures that other handlers build upon. Additionally, analyzing how UNIX and Linux kernels handle mount points provides insight into managing trie transitions within PromiseGrid.
```
EOF_/home/stevegt/lab/grid-cli/v2/doc/325-mount.md